<dom-module id="log-entry">
  <link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
  <link rel="import" href="../../styles/app-theme.html">
    <link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
  <style>
    button {
        padding: 15px;
        border: 1px solid #FFFFFF;
        border-radius: 3px;
        margin-left: 15px;
        cursor: pointer;
        background-color: var(--primary-background-color);
        text-transform: uppercase;
        color: #FFFFFF;
    }
    .log .date {
        @apply(--layout-flex-3);
    }
    .log .view-run {
        @apply(--layout-flex);
    }
    .log ul {
        @apply(--layout);
        @apply(--layout-horizontal);
        list-style: none;
        margin: 0;
        padding: 10px 0;
    }
    .log {
        border-bottom: 1px solid #4E4E4E;
    }
    .log li {
        @apply(--layout);
        @apply(--layout-horizontal);
        padding: 10px;
    }
    .log ul:hover {
        background-image: url('../../images/hover.png');
        background-size: cover;
        background-clip: padding-box;
    }
    .log .cell {
        display: block;
        font-size: 30px;
        font-weight: 700;
        @apply(--layout);
        @apply(--layout-center-justified);
        @apply(--layout-center);
    }
    .log .achievement {
        text-transform: uppercase;
        color: #6EE653;
        font-size: 14px;
        @apply(--layout-flex);
    }
    .log .value {
        font-size: 30px;
        font-weight: 700;
    }
    .log .unit {
        font-size: 22px;
        font-weight: 700;
    }
    .log .icon {
        @apply(--layout-flex);
        @apply(--layout);
        @apply(--layout-horizontal);
        @apply(--layout-self-end);
        padding-right: 30px;
    }

    .insights {
      list-style: none;
      margin: 0;
      padding: 0;
      @apply(--layout);
      @apply(--layout-vertical);
      color: #FFFFFF;
    }
    .insight {
      @apply(--layout-flex-2);
      @apply(--layout);
      @apply(--layout-horizontal);
      margin: 10px 0;
      color: #FFFFFF;
    }
    .insight .info {
      @apply(--layout-flex);
      @apply(--layout-flex-9);
      @apply(--layout-vertical);
    }
    .insight .cell {
      display: block;
      font-size: 24px;
      @apply(--layout);
      @apply(--layout-center);
      @apply(--layout-start-justified);
      @apply(--layout-vertical);
    }
    .insight .icon {
      @apply(--layout-flex-2);
      @apply(--layout);
      @apply(--layout-horizontal);
      @apply(--layout-self-end);
      padding-right: 20px;
      color: var(--primary-icon-color);
      fill: var(--primary-icon-color);
    }
    .insight .icon iron-icon {
      height: 50px;
      width: 50px;
    }
    .insight .info .title {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
    }
  </style>
  <template>
    <div class="log">
        <ul class="insights">
            <li class="cell date">
                <span>{{display.date}}</span>
            </li>
            <li class="insight">
                <div class="icon">
                    <iron-icon icon="face"></iron-icon>
                </div>
                <div class="info">
                    <div class="title">Distance</div>
                    <div class="field">
                        <span class="value">{{display.distance}}</span>
                        <span class="unit">{{display.unit}}</span>
                    </div>
                </div>
            </li>
            <li class="insight">
                <div class="icon">
                    <iron-icon icon="alarm"></iron-icon>
                </div>
                <div class="info">
                    <div class="title">Time</div>
                    <div class="field">
                        <span class="value">{{display.time}}</span>
                    </div>
                </div>
            </li>
            <li class="insight">
                <div class="icon">
                    <iron-icon icon="heart"></iron-icon>
                </div>
                <div class="info">
                    <div class="title">Power</div>
                    <div class="field">
                        <span class="value">{{display.power}}</span>
                        <span class="unit">W</span>
                    </div>
                </div>
            </li>
            <li class="cell achievement">
                Achievement!
            </li>
            <li class="cell view-run">
                <button on-click="viewWorkout">View Run</button>
            </li>
        </ul>
    </div>
  </template>
  <script>
    /*jshint camelcase: false */
  	Polymer({
        is: 'log-entry',
        properties: {
            display: Object
        },
        display: {
            power: '',
            time: '',
            distance: '',
            date: ''
        },
        truncate: function (n) {
            var parts = String(n).split('.');
            var shortened = '';
            if (parts.length > 1) {
                shortened =  parts[0] + '.' + parts[1].substring(0, 2);
            } else {
                shortened =  parts[0];
            }
            
            return shortened;
        },
        fillZero: function (n) {
            n = String(n);
            if (n.length === 1) {
                return '0' + n;
            } else {
                return n;
            }
        },
        setData: function (data) {
            this.data = data;
            var date = new Date(data.timestamp * 1000);
            var dateString = (date.getMonth() + 1) + '/' + date.getDate() + '/' + date.getFullYear();
            this.notifyPath('display.date', dateString);
            this.notifyPath('display.power', this.truncate(data.average_power));

            /* Readable Time */
            var dispTime;
            var time = new Date(data.moving_time * 1000);
            dispTime = this.fillZero(time.getUTCHours()) + ':' + this.fillZero(time.getMinutes()) + '.' + this.fillZero(time.getSeconds());
            this.notifyPath('display.time', dispTime);

            this.notifyPath('display.distance', data.distance);
            this.notifyPath('display.unit', 'KM');
        },
        viewWorkout: function () {
            var workout = document.querySelector('workout-element');
            workout.change(this.data.id);
            var bubbles = document.querySelector('.bubbles');
            window.scrollTo(0, bubbles.offsetTop);
        }
    });
  </script>
</dom-module>
