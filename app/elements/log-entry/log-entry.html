<dom-module id="log-entry">
  <link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
  <link rel="import" href="../../styles/app-theme.html">
  <link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
  <style>
    .button {
        padding: 12px 17px;
        border: 2px solid #FFFFFF;
        border-radius: 6px;
        margin: 3px 8px;
        cursor: pointer;
        background-color: var(--primary-background-color);
        text-transform: uppercase;
        color: #FFFFFF;
        font-size: 16px;
        font-weight: 500;
        overflow: none;
    }
    .log {
        border-bottom: 1px solid #4E4E4E;
    }
    .log .date {
        @apply(--layout-flex-2);
    }
    .log .cell {
        display: block;
        font-size: 30px;
        font-weight: 700;
        @apply(--layout);
        @apply(--layout-center-justified);
        @apply(--layout-center);
    }
    .log .achievement {
        text-transform: uppercase;
        color: #6EE653;
        font-size: 14px;
        @apply(--layout-flex);
    }
    .log .view-run {
        @apply(--layout-flex-auto);
        @apply(--layout-wrap);
        @apply(--layout-end-justified);
    }
    ul.insights {
        @apply(--layout);
        @apply(--layout-flex-5);
        @apply(--layout-horizontal);
        @apply(--layout-wrap);
        list-style: none;
        margin: 0;
        padding: 10px 0;
        color: #FFFFFF;
    }
    ul.insights:hover {
        background-image: url('../../images/hover.png');
        background-size: cover;
        background-clip: padding-box;
    }
    ul.insights li {
        @apply(--layout);
        @apply(--layout-horizontal);
        padding: 10px;
        @apply(--layout-flex);
        margin: 10px 0;
        cursor: pointer;
    }
    .insight .info {
      @apply(--layout-flex);
      @apply(--layout-flex-9);
      @apply(--layout-vertical);
      @apply(--layout-center-justified);
    }
    .insight .cell {
      display: block;
      font-size: 24px;
      @apply(--layout);
      @apply(--layout-center);
      @apply(--layout-start-justified);
      @apply(--layout-vertical);
    }
    .insight .icon {
      @apply(--layout);
      @apply(--layout-horizontal);
      @apply(--layout-self-end);
      @apply(--layout-center-justified);
      padding-right: 20px;
      color: var(--primary-icon-color);
      fill: var(--primary-icon-color);
    }
    .insight .value {
        font-size: 30px;
        font-weight: 400;
    }
    .insight .unit {
        font-size: 22px;
        font-weight: 400;
    }
    .insight .icon iron-icon {
      height: 50px;
      width: 50px;
    }
    .insight .info .title {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
    }
    .dropdown {
        position: relative;
    }
    .dropdown:hover {
        border-bottom: none;
    }
    .dropdown:hover ul {
        display: block;
        visibility: visible;
        opacity: 1;
    }
    .dropdown ul {
        display: none;
        visibility: hidden;
        opacity: 0;
        position: absolute;
        padding: 0;
        margin: 0 0 0 -2px;
        top: 40px;
        left: 0;
        width: 100%;
        border: 2px solid #FFFFFF;
        border-top: none;
        background-color: var(--primary-background-color);
        -webkit-transiton: opacity 0.4s;
        -moz-transition: opacity 0.4s;
        -ms-transition: opacity 0.4s;
        -o-transition: opacity 0.4s;
        transition: opacity 0.4s;
        z-index: 10;
    }
    .dropdown li {
        display: block;
        z-index: 11;
        padding: 10px;
    }
  </style>
  <template>
    <div class="log" on-click="viewWorkout">
        <ul class="insights">
            <li class="cell date">
                <span>{{display.date}}</span>
            </li>
            <li class="insight">
                <div class="icon">
                    <iron-icon icon="alarm"></iron-icon>
                </div>
                <div class="info">
                    <div class="title">Distance</div>
                    <div class="field">
                        <span class="value">{{display.distance}}</span>
                        <span class="unit">{{display.unit}}</span>
                    </div>
                </div>
            </li>
            <li class="insight">
                <div class="icon">
                    <iron-icon icon="alarm"></iron-icon>
                </div>
                <div class="info">
                    <div class="title">Time</div>
                    <div class="field">
                        <span class="value">{{display.time}}</span>
                    </div>
                </div>
            </li>
            <li class="insight">
                <div class="icon">
                    <iron-icon icon="alarm"></iron-icon>
                </div>
                <div class="info">
                    <div class="title">Power</div>
                    <div class="field">
                        <span class="value">{{display.power}}</span>
                        <span class="unit">W</span>
                    </div>
                </div>
            </li>
            <li class="cell achievement">
                Achievement!
            </li>
            <li class="cell view-run">
                <button on-click="viewWorkout" class="button">View Run</button>
                <div class="dropdown button">
                    Options
                    <iron-icon icon="arrow-drop-down"></iron-icon>
                    <ul>
                        <li on-click="deleteWorkout">Delete Activity</li>
                        <!-- <li on-click="editWorkout">Edit Activity</li> -->
                    </ul>
                </div>
            </li>
        </ul>
    </div>
  </template>
  <script>
    /*jshint camelcase: false*/
    /*global jwt*/
    /*global superagent*/
  	Polymer({
        is: 'log-entry',
        properties: {
            display: Object
        },
        display: {
            power: '',
            time: '',
            distance: '',
            date: ''
        },
        setData: function (data) {
            this.data = data;
            var date = new Date(data.timestamp * 1000);
            var dateString = (date.getMonth() + 1) + '/' + date.getDate() + '/' + date.getFullYear();
            this.notifyPath('display.date', dateString);
            this.notifyPath('display.power', data.average_power.stat());

            /* Readable Time */
            var dispTime = hmsTime(setDate(data.moving_time));
            this.notifyPath('display.time', dispTime);

            this.notifyPath('display.distance', kmDistance(data.distance));
            this.notifyPath('display.unit', 'KM');
        },
        viewWorkout: function () {
            workoutFetching(this.data.id);
            var bubbles = document.querySelector('.bubbles');
            window.scrollTo(0, bubbles.offsetTop);
        },
        deleteWorkout: function () {
            superagent
                .del('/b/api/v1/activities/' + this.data.id)
                .send()
                .set('Accept', 'application/json')
                .set('Authorization', 'Bearer: ' + jwt.token)
                .end(function(err, res) {
                    if (res.ok) {
                        this.parentNode.removeChild(this);
                    } else {
                        console.log('failed to delete element');
                    }
                }.bind(this));
        }
    });
  </script>
</dom-module>
