<dom-module id="log-book">
    <link rel="import" href="../log-entry/log-entry.html">
    <style>
        .sample {
            display: none;
        }
        :host.sample .sample {
            display: block;
        }
        section {
            background-color: var(--dark-background-color);
            padding: 4vw;
        }
        h1.header {
            @apply(--header);
        }
        h2.subtitle {
            @apply(--subtitle);
        }
        .subnav {
            @apply(--layout-horizontal);
            @apply(--layout-justified);
            padding-bottom: 2vw;
        }
        .subnav .title {
        }
        .subnav .filters {
            @apply(--layout-horizontal);
            @apply(--layout-around-justified);
            @apply(--layout-center);
        }
        .logs .seperator {
            @apply(--layout-horizontal);
            border-bottom: 1px solid #4E4E4E;
            padding-bottom: 10px;
            color: #FFFFFF;
            text-transform: uppercase;
        }
        .logs .seperator .month {
            @apply(--layout-flex-2);
        }
        .logs .seperator .year {
            @apply(--layout-flex-4);
        }

        .horizontal-section {
            text-align: center;
            @apply(--layout-flex-4);
        }
        .vertical-section {
            text-align: center;
            @apply(--layout-flex-2);
        }
        paper-dropdown-menu {
            text-align: left;
        }
        paper-menu {
            display: block;
        }
        paper-tab {
            width: 4vw;
            color: white;
        }

        .full-log {
            margin: 0 auto;
            margin-top: 4vw;
            text-align: center;
            width: 13vw;
            font-size: 1.2vw;
        }
        .button {
            padding: 0.9vw 1.1vw;
            border: 2px solid #FFFFFF;
            border-radius: 6px;
            cursor: pointer;
            background-color: var(--primary-background-color);
            color: #FFFFFF;
            font-size: 1vw;
            font-weight: 500;
            text-transform: uppercase;
        }
    </style>
    <template>
        <!--<div class="seperator"></div>-->
        <section 
            data-step="8"
            data-intro="Analyze your latest runs. Clicking on the run will load it into the graph & map.">
            <div class="subnav">
                <div class="title">
                    <h1 class="header">Run History</h1>
                    <h2 class="subtitle sample">Sample Data</h2>
                </div>
                <div class="filters">
                    <button on-click="expandLogs" is="stryd-button">Expand Logs</button>
                    <div class="horizontal-section">
                        <paper-dropdown-menu label="Sort By" id="sortDropdown">
                            <paper-tabs attr-for-selected="value" class="dropdown-content" selected="date">
                                <paper-tab value="date">Date</paper-tab>
                                <paper-tab value="duration">Duration</paper-tab>
                                <paper-tab value="distance">Distance</paper-tab>
                                <paper-tab value="power">Power</paper-tab>
                            </paper-tabs>
                        </paper-dropdown-menu>
                    </div>
                    <div class="vertical-section">
                        <paper-dropdown-menu label="Order" id="orderDropdown">
                            <paper-menu attr-for-selected="value" class="dropdown-content" selected="dec">
                                <paper-item value="dec">Decending</paper-item>
                                <paper-item value="asc">Ascending</paper-item>
                            </paper-menu>
                        </paper-dropdown-menu>
                    </div>
                </div>
            </div>
            <div class="logs" id="logContainer"></div>
            <!-- <div class="full-log button hidden">Load 10 More Workouts</div> -->
        </section>
    </template>
    <script>
        Polymer({
            is: 'log-book',
            listeners: {
                'orderDropdown.mouseenter': '',
                'orderDropdown.mouseleave': '',
                'sortDropdown.mouseenter': '',
                'sortDropdown.mouseleave': '',
            },
            sampleLog: function () {
                sampleFetching();
            },
            addLog: function (log) {
                var logEle = document.createElement('log-entry');
                logEle.setData(log);
                var targetChild = null;
                var existing = false;
                for (var i = 0; i < this.$.logContainer.children.length; i++) {
                    var child = this.$.logContainer.children[i];
                    if (log.id === child.data.id) {
                        existing = true;
                    }
                    if (log.timestamp > child.data.timestamp) {
                        targetChild = child;
                        break;
                    }
                }
                if (!existing) {
                    this.$.logContainer.insertBefore(logEle, targetChild);
                }
            },
            expandLogs: function () {
                for (var i = 0; i < this.$.logContainer.children.length; i++) {
                    var child = this.$.logContainer.children[i];
                    child.toggle();
                }
            },
            populateLogs: function (logs) {
                console.log('Trying to populate logs:', logs);
                while (this.$.logContainer.firstChild) {
                    this.$.logContainer.removeChild(this.$.logContainer.firstChild);
                }
                if (logs.length === 0) {
                    this.sampleLog();
                } else {
                    var log, i;
                    for (i = 0; i < logs.length; i++) {
                        log = logs[i];
                        this.addLog(log);
                    }
                }
                this.$.logContainer.firstChild.viewWorkout();
            }
        });
    </script>
</dom-module>
