<dom-module id="stryd-settings">
  <link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
  <link rel="import" href="../../styles/app-theme.html">
  <link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
  <link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
  <style>
    :host {
      display: block;
    }

    form {
      margin-top: 30px;
    }
  </style>
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/dropzone/4.0.1/min/dropzone.min.css">
  <template>
    <platform-connect></platform-connect>
    <form class="dropzone" id="file"></form>
  </template>
  <script src="../../scripts/dropzone.js"></script>
  <script>
    /*global Dropzone*/
    /*global jwt*/

      Polymer({
        is: 'stryd-settings',
        properties: {
        },
        ready: function() {
          this.attached();
        },
        attached: function() {
          if (!this.Dropzone) {
            var d = this.querySelector('#file');
            this.Dropzone = new Dropzone(d, {
              paramName: 'file', // The name that will be used to transfer the file
              url: '/b/platform/data/stryd',
              headers: {
                'Authorization': 'Bearer: ' + jwt.token
              },
              maxFilesize: 60, // MB
              acceptedFiles: '.fit',
              uploadMultiple: false,
              addRemoveLinks: true,
              dictDefaultMessage: 'Drop your FIT file here to upload (Or click to select from computer)',
              dictInvalidFileType: 'File type is not supported. Please upload valid sports watch data file.',
              accept: function (file, done) {
                done();
              },
              success: function (file, message) {
                console.log(message);
              },
              error: function (file, message) {
                console.log(message);
              },
              sending: function (file, xhr, formData) {
                var uid = new Date().getUTCMilliseconds();
                var fileMetaData = {
                  sizeInBytes: file.size,
                  uploadId: String(uid),
                  md5: '',
                  oauthToken: jwt.token,
                  privacy: 'public',
                  activityIds: [1]
                };
                formData.append('uploadMetaData', JSON.stringify(fileMetaData));
              }
            });
          }
        }
      });
  </script>
</dom-module>
