<dom-module id='map-run'>
    <style>
        #map {
            width: 100%;
            height: 500px;
        }
    </style>
    <template>
        <div id='map'></div>
        <!-- <button on-click='toggle'>Toggle Map Style</button> -->
        <!-- <map-summary></map-summary> -->
    </template>
    <script>


        var map, strydLightStyle, strydDarkStyle, strydLightId, strydDarkId;
        /* exported mapReady */
        var mapReady = function () {
            strydDarkStyle = new google.maps.StyledMapType(
            [
                {
                    'featureType': 'All',
                    'elementType': 'All'
                }, {
                    'featureType': 'All',
                    'elementType': 'All',
                    'stylers': [
                        { 'lightness': -75 },
                        { 'hue': '#171B1F' },
                        { 'saturation': -96 },
                        { 'weight': 6.2 },
                        { 'visibility': 'simplified' },
                        { 'gamma': 0.64 }
                    ]
                },
                {
                    'elementType': 'labels.text',
                    'stylers': [
                        { 'visibility': 'off' }
                    ]
                }
            ], {
                name: 'StrydDark'
            });
            strydLightStyle = new google.maps.StyledMapType(
            [
                {
                    'stylers':[
                        {'visibility': 'simplified'},
                        {'gamma': 0.56},
                        {'hue': '#ffaa00'},
                        {'weight': 4.4},
                        {'opacity': 0.5},
                        {'lightness': 20}
                    ] 
                },
                {
                    'elementType': 'labels.text',
                    'stylers': [
                        { 'visibility': 'off' }
                    ]
                }
            ], {
                name: 'StrydLight'
            });
            strydDarkId = 'strydDarkStyle';
            strydLightId = 'strydLightStyle';
            map = new google.maps.Map(document.querySelector('#map'),
            {
                center: {
                    lat: 40.0274,
                    lng: -105.2519
                },
                zoom: 14,
                panControl: false,
                zoomControl: true,
                scaleControl: false,
                scrollwheel: false
            });
            map.mapTypes.set(strydDarkId, strydDarkStyle);
            map.mapTypes.set(strydLightId, strydLightStyle);
            map.setMapTypeId(strydDarkId);
        };
        Polymer({
            is: 'map-run',
            ready: function () {
                this.center = {
                    lat: 0,
                    lng: 0
                };
                this.dark = true;
            },
            toggle: function () {
                if (this.dark) {
                    map.setMapTypeId(strydLightId);
                } else if (!this.dark) {
                    map.setMapTypeId(strydDarkId);
                }
                this.dark = !this.dark;
            },
            setData: function (graphSegments) {
                var i, path, step, graphSegment;
                step = 1;
                if (graphSegments.length > 200) {
                    step = parseInt(graphSegments.length / 200);
                }
                console.log('gsLength', graphSegments.length);
                for (i = 1; i < graphSegments.length; i=i+step) {
                    graphSegment = graphSegments[i];
                    path = new google.maps.Polyline({
                        path: graphSegment.location,
                        geodesic: false,
                        strokeColor: graphSegment.hex,
                        strokeOpacity: 1,
                        strokeWeight: 6
                    });
                    path.setMap(map);
                }
                console.log(graphSegments);
                this.center.lat = graphSegments[0].location[0].lat;
                this.center.lng = graphSegments[0].location[0].lng;
                map.setCenter(this.center);
                // Start Marker
                new google.maps.Marker({
                    position: {
                        lat: this.center.lat,
                        lng: this.center.lng
                    },
                    map: map
                });
                // End Marker
                new google.maps.Marker({
                    position: {
                        lat: graphSegments[graphSegments.length-1].location[0].lat,
                        lng: graphSegments[graphSegments.length-1].location[0].lng
                    },
                    map: map
                });
            }
        });
    </script>
    <script async defer src='https://maps.googleapis.com/maps/api/js?key=AIzaSyC-D84ZWKQT9kbZ8meKUu1yvklQUtWRiOg&callback=mapReady'></script>
</dom-module>