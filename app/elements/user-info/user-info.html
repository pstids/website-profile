<dom-module id="user-info">
    <style>
        :host {
            @apply(--layout-horizontal);
            @apply(--layout-justified);
        }
        h1.title {
            @apply(--header);
        }
        .edit {
            @apply(--layout-horizontal);
            @apply(--layout-center);
            @apply(--subtitle);
            -webkit-user-select: none;
            -moz-user-select: none;
            -khtml-user-select: none;
            -ms-user-select: none;
        }
        iron-icon {
            width: 1.2vw;
            height: 1.2vw;
            padding-right: 0.5vw;
        }
        .icon-tag {
            width: 1.2vw;
            height: 1.3vw;
        }
        [option="display"] .editable {
            display: none;
        }
        [option="editable"] .display {
            display: none;
        }

        .image {
            @apply(--layout-vertical);
            @apply(--layout-center);
            @apply(--layout-center-justified);
            text-align: center;
            color: white;
            width: 12vw;
        }
        .image img {
            max-width: 100%;
            width: 100%;
            height: auto;
            border-radius: 50%;
            border: 6px solid #484846;
        }
        .image h1 {
            font-size: 26px;
            color: white;
            text-transform: uppercase;
            line-height: 48px;
            margin: 0;
            padding: 0;
        }

        .details {
            @apply(--layout-vertical);
            font-size: 1vw;
            width: 21vw;
        }
        .information {
            @apply(--layout-horizontal);
            padding: 0.6vw 0;
        }
        .information .info {
            text-transform: uppercase;
        }
        .information .info.big {
            @apply(--layout-flex-10);
        }
        .information .info.small {
            @apply(--layout-flex-5);
        }
        .information .info h1 {
            font-size: 0.67vw;
            color: var(--primary-header-color);
            margin: 0;
            padding: 0;
        }
        .information .info p {
            font-size: 1.67vw;
            margin: 0;
            padding: 0.5vw 0;
            color: white;
            font-weight: 700;
        }
        input[type=text] {
            background: transparent;
            border: none;
            border-bottom: 1px solid var(--primary-background-color);
            outline: none;
            padding: 0.5vw 0;
            color: white;
            width: 70%;
            font-size: 1.67vw;
        }
        input[type=text]:focus {
            border-bottom: 1px solid var(--primary-header-color);
        }
        .information #birthday-input input[type=text] {
            width: 25%;
        }
        *::-webkit-input-placeholder {
            color: grey;
            font-weight: 300;
        }
        *:-moz-placeholder {
            color: grey;
            font-weight: 300;
        }
        *::-moz-placeholder {
            color: grey;
            font-weight: 300;
        }
        *:-ms-input-placeholder {
            color: grey;
            font-weight: 300;
        }

        .about-me {
            width: 20vw;
        }
        .about-me p {
            font-weight: 300;
            font-size: 1vw;
            color: white;
            line-height: 1.8;
        }
        .about-me paper-textarea {
            font-weight: 300;
            font-size: 1vw;
            color: white;
            line-height: 1.8;
            min-height: 100%;
        }
    </style>
    <template>
        <div class="image">
            <img src="{{userLocal.profile}}">
            <h1>{{userLocal.name}}</h1>
        </div>
        <div class="details" option="display" id="details">
            <h1 class="title">Details</h1>
            <div class="edit" on-click="toggleEditDetails">
                <iron-icon class="display" icon="editor:mode-edit"></iron-icon>
                <span class="display icon-tag">Edit</span>
                <iron-icon class="editable" icon="icons:save"></iron-icon>
                <span class="editable icon-tag">Save</span>
            </div>
            <div class="information">
                <div class="info big">
                    <h1>Date of Birth</h1>
                    <p class="display">
                        <span>{{userLocal.birth.month}}</span>/<span>{{userLocal.birth.day}}</span>/<span>{{userLocal.birth.year}}</span>
                    </p>
                    <div id="birthday-input">
                        <input type="text" placeholder="Month" class="editable" name="month" value="{{userLocal.birth.month::input}}">
                        <input type="text" placeholder="Day" class="editable" name="day" value="{{userLocal.birth.day::input}}">
                        <input type="text" placeholder="Year" class="editable" name="year" value="{{userLocal.birth.year::input}}">
                    </div>
                </div>
                <div class="info small">
                    <h1>Age</h1>
                    <p>21</p>
                </div>
                <div class="information">
                    <div class="info big">
                        <h1>Gender</h1>
                        <p class="display">{{userLocal.gender}}</p>
                        <paper-radio-group 
                            selected="{{userLocal.gender}}"
                            attr-for-selected="name"
                            class="editable">
                            <paper-radio-button name="male">Male</paper-radio-button>
                            <paper-radio-button name="female">Female</paper-radio-button>
                            <paper-radio-button name="other">Other</paper-radio-button>
                        </paper-radio-group>
                    </div>
                    <div class="info small">
                        <h1>Height (<span>{{heightUnit(userLocal.units)}}</span>)</h1>
                        <p class="display">{{heightValue(userLocal.height, userLocal.units)}}</p>
                        <input type="text" placeholder="Height" class="editable" name="height" id="height">
                    </div>
                </div>
                <div class="info small">
                    <h1>Height (<span>{{heightUnit()}}</span>)</h1>
                    <p class="display">{{userLocal.height.value}}</p>
                    <input type="text" placeholder="Height" class="editable" name="height" value="{{userLocal.height::input}}">
                </div>
            </div>
            <div class="information">
                <div class="info big">
                    <h1>Location</h1>
                    <p class="display">
                        <span>{{userLocal.city}}</span>,
                        <span>{{userLocal.state}}</span>
                    </p>
                    <input type="text" placeholder="City, State" class="editable" name="location"
                           value="{{userLocal.city::input}}, {{userLocal.state::input}}">
                </div>
                <div class="info small">
                    <h1>Weight (<span>{{weightUnit()}}</span>)</h1>
                    <p class="display">{{userLocal.weight}}</p>
                    <input type="text" placeholder="Weight" class="editable" name="weight" value="{{userLocal.weight::input}}">
                </div>
            </div>
        </section>
        <div class="prefs">
            <h1 class="title">Preferences</h1>
            <div class="pref">
                <h2 class="subtitle">Display</h2>
                <paper-radio-group
                    selected="{{userLocal.units}}"
                    attr-for-selected="name"
                    id="radio">
                    <paper-radio-button name="feet">Miles and Pounds</paper-radio-button>
                    <paper-radio-button name="meters">Kilometers and Kilograms</paper-radio-button>
                </paper-radio-group>
            </div>
            <p class="display">{{userLocal.about}}</p>
            <paper-textarea class="editable" label="Introduce yourself to the world" char-counter maxlength="200" max-rows="5"><paper-textarea>
        </div>
        <paper-toast duration="1300" text="" id="toast"></paper-toast>
    </template>
    <script src="//crypto-js.googlecode.com/svn/tags/3.0.2/build/rollups/md5.js"></script>
    <script>
        /*global CryptoJS*/
        Polymer({
            is: 'user-info',
            properties: {
                userLocal: {
                    type: Object,
                    notify: true
                }
            },
            attached: function () {
                var aboutStr = user.data.about;
                if (!aboutStr) {
                    aboutStr = 'Running doesnâ€™t require a gym, a playing field, an arena, or a court. It can be done pretty much anywhere in the world at any time.';
                }
                this.userLocal = {
                    birth: {
                        day: '30',
                        month: '12',
                        year: '88'
                    },
                    gender: user.data.gender,
                    height: user.data.height,
                    city: user.data.city,
                    state: user.data.city,
                    weight: user.data.weight,
                    name: user.data.user_name,
                    profile: this.setProfileIMG(),
                    about: aboutStr,
                    units: user.data.units
                };
            },
            saveDetails: function () {
                superagent
                        .put('/b/api/v1/users/' + user.id)
                        .send(this.user)
                        .set('Accept', 'application/json')
                        .set('Authorization', 'Bearer: ' + jwt.token)
                        .end(function(err, res) {
                            if (res.ok) {
                                this.$.toast.text = 'Details updated!';
                            } else {
                                this.$.toast.text = 'Details not updated. Please try again.';
                            }
                            this.$.toast.show();
                        }.bind(this));
            },
            setProfileIMG: function () {
                this.defaultURL = 'https://www.stryd.com/profile/images/leopard.png';
                if (user.data.profile !== '') {
                    return decodeURIComponent(user.data.profile.replace('+', ' '));
                } else {
                    var gravHash = CryptoJS.MD5(user.data.email.toLowerCase());
                    return 'http://www.gravatar.com/avatar/' + gravHash + '?d=' + this.defaultURL;
                }
            },
            toggleEditDetails: function () {
                var options = this.$.details.getAttribute('option');
                if (options === 'display') {
                    this.$.details.setAttribute('option', 'editable');
                } else {
                    this.$.details.setAttribute('option', 'display');
                }
            },
            toggleEditAbout: function () {
                var options = this.$.about.getAttribute('option');
                if (options === 'display') {
                    this.$.about.setAttribute('option', 'editable');
                } else {
                    this.$.about.setAttribute('option', 'display');
                }
            },
            weightUnit: function (unit) {
                if (unit === 'feet') {
                    return 'lbs';
                } else {
                    return 'kg';
                }
            },
            weightValue: function (value, unit) {
                if (unit === 'feet') {
                    var pounds = value / 2.20462;
                    return parseInt(pounds);
                } else {
                    return parseInt(value);
                }
            },
            heightUnit: function (unit) {
                if (unit === 'feet') {
                    return 'feet & inches';
                } else {
                    return 'cm';
                }
            },
            heightValue: function (value, unit) {
                if (unit === 'feet') {
                    var totalInches = value / 2.54;
                    var feet = totalInches / 12;
                    var fraction = feet - Math.floor(feet);
                    var inches = (12 * fraction).toFixed(0);
                    return parseInt(feet) + '\'' + parseInt(inches) + '"';
                } else {
                    return parseInt(value);
                }
            },
            getAge: function (year, month, day) {
                if (year === 0 && month === 0 && day === 0) {
                    return 0;
                }
                var today = new Date();
                var birth = new Date(
                    year,
                    month - 1,
                    day
                );
                return today.getFullYear() - birth.getFullYear();
            }
        });
    </script>
</dom-module>